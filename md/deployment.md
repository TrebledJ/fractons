###### Last Updated: Thursday, April 4, 2019

# Deploying

### Navigate to the Project File (.pro extension)
Follow the guidance on the `.pro` file automatically generated by Felgo.

1. comment the `DEPLOYMENTFOLDERS += qmlFolder` line above, to avoid shipping your qml files with the application (instead they get compiled to the app binary)
2. uncomment the `resources.qrc` file inclusion and **add any qml subfolders to the .qrc file**; this compiles your qml files and js files to the app binary and protects your source code
3. change the `setMainQmlFile()` call in `main.cpp` to the one starting with `"qrc:/"` - this loads the qml files from the resources

Also comment out any instances and includes of Felgo's Live Client.

### Change the Build to *Release* Mode

### Clean and Build Once

### Delete all files/folders from `application.app/Contents/Resources`.

Leave behind `./assets/sounds` folder and `./app_icons.icns`.

### Use the `macdeployqt` Terminal Utility

When deploying, use the `macdeployqt` executable tool. Run the following from the command line, replacing appropriately.

	macdeployqt <ApplicationName>.app -qmldir=<Path-to-QMLs>
	
To deploy as a disk-mounted image, add the `-dmg` flag:

	macdeployqt <ApplicationName>.app -dmg -qmldir=<Path-to-QMLs>

Specifically, this was the command I runned after `cd`ing to the shadow build directory.

	cd `dirname /Users/JLAW/Documents/BitBucket/build-Fractureuns-V_Play_Desktop_Qt_5_11_1_clang-Release/Fractureuns.app`
	macdeployqt Fractureuns.app -qmldir=/Users/JLAW/Documents/BitBucket/Fractureuns/src/qml -dmg

### Delete all frameworks except for the relevant ones:

* QtCharts
* QtCore
* QtGui
* QtMultimedia
* QtMultimediaQuick
* QtNetwork
* QtOpenGL
* QtPrintSupport
* QtQml
* QtQuick
* QtQuickControls2
* QtQuickTemplates2
* QtSql
* QtWebSockets
* QtWidgets

### Delete all plugins except for the relevant ones:

* audio
* mediaservice/libqavfmediaplayer.dylib
* mediaservice/libqtmedia_audioengine.dylib
* platforms
* quick
* sqldrivers/libqsqlite.dylib

### Delete all folders from `Resources/qml` except for the relevant ones:

* Felgo
* Qt
* QtCharts
* QtGraphicalEffects
* QtMultimedia
* QtQml
* QtQuick
* QtQuick.2
* VPlay

### Create a Disk Image using Disk Utility

* Copy your app to a **new folder** (<kbd>⌘</kbd>+<kbd>Shift</kbd>+<kbd>N</kbd>).
* Open Disk Utility → File → New Image → Image From Folder.
* Select the folder where you have placed the App. Give a name for the DMG and save. This creates a distributable image for you.

[Source](https://stackoverflow.com/questions/37292756/how-to-create-a-dmg-file-for-a-app-for-mac)


----

### April 14th Discoveries (Specific to ƒractons):

Once `macdeployqt` is run:

1. `Contents/Frameworks` can be deleted.

2. In `Contents/Resources/qml`, the following should be kept:

	* `Felgo/core`
	* `QtCharts`

			 libqtchartsqml2.dylib
			 qmldir
			 
	* `QtGraphicalEffects`
	
			 libqtgraphicaleffectsplugin.dylib
			 private/libqtgraphicaleffectsprivate.dylib
			 private/qmldir
			 qmldir
			 RadialGradient.*
			 
	* `QtMultimedia`
			
			 libdeclarative_multimedia.dylib
			 qmldir
			 
	* `QtQuick/Controls`
	
	        ApplicationWindow.qml
	        Button.qml
	        libqtquickcontrolsplugin.dylib
	        Menu.qml
	        MenuBar.qml
	        Private/...
	        qmldir
	        ScrollView.qml
	        Slider.qml
	        Styles/Base/ButtonStyle.qml
	        Styles/Base/ScrollViewStyle.qml
	        Styles/Base/SliderStyle.qml
	        Styles/Base/SwitchStyle.qml
	        Styles/Base/TextFieldStyle.qml
	        Styles/qmldir
	        TextField.qml
	        
	* `QtQuick/Controls/Private`
	        
	        BasicButton.qml
	        CalendarUtils.js
	        ColumnMenuContent.qml
	        ContentItem.ml
	        Control.qml
	        EditMenu_base.qml
	        EditMenu.qml
	        FastGlow.qml
	        FocusFrame.qml
	        MenuContentItem.qml
	        MenuContentScroller.qml
	        ModalPopupBehavior.qml
	        qmldir
	        ScrollBar.qml
	        ScrollViewHelper.qml
	        SourceProxy.qml
	        StackView.js
	        style.js
	        Style.qml
	        SystemPaletteSingleton.qml
	        TextHandle.qml
	        TextInputWithHandles.qml
	        TextSingleton.qml
	      
	* `QtQuick/Controls.2`
			 
			 ItemDelegate.qml
			 libqtquickcontrols2.plugin.dylib
			 Popup.qml
			 ProgressBar.qml
			 qmldir
			 ScrollBar.qml
			 StackView.qml
			 TextField.qml
	        
	* `QtQuick/Layouts`
	* `QtQuick/LocalStorage`
	* `QtQuick/Templates.2`
	* `QtQuick/Window.2`
	* `QtQuick.2`

3. In `Contents/Resources`, the following should be kept:
		 
		 app_icon.icns
		 assets/*
		 qml/*             (after performing step 2)
		 qt.conf

4. In `Contents/Plugins`, the following should be kept:
		 
		 audio/libqtaudio_coreaudio.dylib
		 mediaservice/libqavfmediaplayer.dylib
		 mediaservice/libqtmedia_audioengine.dylib
		 platforms/libqcocoa.dylib
		 quick/libdeclarative_multimedia.dylib
		 quick/libqmllocalstorageplugin.dylib
		 quick/libquicklayoutsplugin.dylib
		 quick/libqtchartsqml2.dylib
		 quick/libqtgraphicaleffectsplugin.dylib
		 quick/libqtgraphicaleffectsprivate.dylib
		 quick/libqtquick2plugin.dylib
		 quick/libqtquickcontrols2plugin.dylib
		 quick/libqtquickcontrolsplugin.dylib
		 quick/libqtquicktemplates2plugin.dylib
		 quick/libwindowplugin.dylib
		 sqldrivers/libqsqlite.dylib
		 
0. Once the `*.qmlc` files are generated, the `*.qml` files can be deleted.
0. The `*.jsc` files should be deleted, as they can be generated by the `*.js` files.

<strike>0. All `*.qmlc` files can be deleted. These can be found in `Contents/Resources/qml`.</strike>

----



# Publishing

When publishing, the project stage needs to be changed from `"test"` to `"publish"` in the `config.json` file under the `qml` subfolder.

For projects with multiple developers or plugins, a [license key](https://felgo.com/developers/license) is recommended and needs to be set on the root parent widget ([`App::licenseKey`](https://felgo.com/doc/felgo-app/#licenseKey-prop) or [`GameWindow::licenseKey`](https://felgo.com/doc/felgo-gamewindowitem/#licenseKey-prop)).

Publishing on the App Store and Google Play needs to be licensed (requires payment).


For more info, see [Deploy Felgo Games and Apps](https://felgo.com/doc/felgo-deployment/) and [Publish Felgo Games and Apps](https://felgo.com/doc/felgo-publishing/).